## Cross site request forgery: Getting other users to do your dirty work for you
Do you remember Netflix? Not the Netflix we have now, the Netflix that used to [rent you DVDs by mailing them to you](https://www.youtube.com/watch?v=mCEkFkvt7EQ). My next story is about how someone managed to convince Netflix users to send him their DVDs - free of charge.

Have you ever clicked on a hyperlink, only to [find something that you weren't expecting?](https://youtu.be/dQw4w9WgXcQ) If you were lucky, you might have just gotten Rickrolled. If you were unlucky...

Let's just say there are older and fouler things than Rick Astley in the dark places of the web.

What if you could convince people to visit a page you controlled? And what if those people were Netflix users, and they were logged in? In 2006, [Dave Ferguson did just that](https://appsecnotes.blogspot.com/2009/01/netflix-csrf-revisited.html). He created a harmless-looking page with an image on it:

```
<img src="http://www.netflix.com/JSON/AddToQueue?movieid=70110672" />
```

Did you notice the source URL of the image? It's deliberately crafted to add a particular DVD to your queue. Sprinkle in a few more requests to change the user's name and shipping address, and you could ship yourself DVDs _completely free of charge!_

This attack is possible when websites unconditionally trust a user's session [cookies](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies) without checking where HTTP requests come from.

The first check you can make is to verify that a request's [origin](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin) and [referer](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer) headers match the location of the website. These headers can't be programmatically set.

Another check you can use is to add <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet#Synchronizer_Token_Pattern">CSRF tokens</a>[]() to your web forms, to verify requests have come from an actual form on your website. Tokens are long, unpredictable, unique strings that are generated by your server and inserted into web forms. When users complete a form, the form data sent to the server can be checked for a recently generated token. This is an effective deterrent of CSRF attacks because CSRF tokens aren't stored in cookies.

You can also set `SameSite=Strict` when setting cookies with the [Set-Cookie HTTP header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie). This communicates to browsers that cookies are not to be sent with cross-site requests. This is a relatively new feature, though it is [well supported](https://caniuse.com/#feat=same-site-cookie-attribute) in evergreen browsers.
